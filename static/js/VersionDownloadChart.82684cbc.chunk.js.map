{"version":3,"sources":["styles/VersionTooltip.module.scss","styles/VersionLegend.module.scss","chartColor.ts","styles/VersionDownloadChart.styles.ts","components/VersionTooltip.tsx","components/VersionDownloadChart.tsx","components/VersionLegend.tsx"],"names":["module","exports","styles","minLuminance","maxLuminance","saturation","defaultLightness","colorCache","colorForHue","hue","opts","cacheEntry","record","targetLuminance","variant","result","lightness","h","s","contrastingColor","relativeLuminance","adjustLightnessForContrast","push","hueDifference","hue1","hue2","Math","abs","l","r","g","b","c","x","m","r1","g1","b1","round","hsl2rgb","standardToLinear","pow","theme","unit","areaChart","margin","top","right","bottom","area","isAnimationActive","stroke","isInverted","palette","whiteTranslucent40","blackTranslucent40","responsiveContainer","width","height","grid","strokeDasharray","xAxis","tickLine","tickMargin","tick","fill","semanticColors","bodyText","yAxis","tickSize","tickCount","tooltip","animationDuration","animationEasing","offset","VersionTooltipContent","label","payload","versionHues","reversedItems","reverse","ThemeContext","Consumer","contextTheme","versionsList","length","className","map","entry","i","colorChipColor","name","color","formattedValue","count","measurementTransform","versionCounts","pct","Object","values","reduce","a","toLocaleString","formatCount","value","versionsListItem","versionColorIndicator","style","backgroundColor","Text","versionLabel","versionCount","ThemeProvider","frame","bodyBackground","date","unixTime","Date","toLocaleDateString","month","day","fromDayStart","duration","dayStart","setHours","getTime","VersionDownloadChart","history","maxDaysShown","maxVersionsShown","maxTicks","showLegend","showTooltip","versionLabeler","tooltipTheme","styleProps","legendElement","setLegendElement","useState","filteredHistory","React","useMemo","n","windowInDays","points","latestDate","earliestAllowableDate","versionsInWindow","point","version","entries","existingCount","topVersions","Set","sort","slice","_count","filteredPoints","topVersionsOnDate","keys","filter","v","has","filteredPoint","topVersion","versions","filterTopN","dateTicks","dates","first","last","dataDuration","maxInteriorTicks","tickInterval","floor","ticks","nextTick","add","calculateDateTicks","p","hues","lastAvoidToken","forEach","avoidToken","randomGenerator","randomSeed","create","triesRemaining","random","adjacentHue","allHues","find","otherHue","generateHue","chartAreas","dataKey","VersionLegend","memo","versionsListContainer","props","ResponsiveContainer","AreaChart","data","reverseStackOrder","stackOffset","XAxis","type","scale","domain","tickFormatter","interval","YAxis","Tooltip","content","tooltipProps","Legend","createPortal","Area","key","datapoint","stackId","fillOpacity","CartesianGrid","ref","el","undefined"],"mappings":"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","file":"static/js/VersionDownloadChart.82684cbc.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"frame\":\"VersionTooltip_frame__3Lv0n\",\"date\":\"VersionTooltip_date__1GwoG\",\"versionsList\":\"VersionTooltip_versionsList__6ks3l\",\"versionsListItem\":\"VersionTooltip_versionsListItem__1E-df\",\"versionColorIndicator\":\"VersionTooltip_versionColorIndicator__201KA\",\"versionLabel\":\"VersionTooltip_versionLabel__2ZozQ\",\"versionCount\":\"VersionTooltip_versionCount__2olVR\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"versionsListContainer\":\"VersionLegend_versionsListContainer__2kfsM\",\"versionsList\":\"VersionLegend_versionsList__gyOfc\",\"versionsListItem\":\"VersionLegend_versionsListItem__2Sxmb\",\"versionColorIndicator\":\"VersionLegend_versionColorIndicator__L-tB-\",\"versionLabel\":\"VersionLegend_versionLabel__1tflT\"};","import randomSeed from \"random-seed\";\n\nexport type AvoidToken = {\n  adjacentHue: number;\n  allHues: number[];\n};\n\nconst styles = {\n  againstDark: {\n    minLuminance: 0.3,\n  },\n  againstLight: {\n    maxLuminance: 0.3,\n  },\n  dark: {\n    saturation: 0.5,\n    defaultLightness: 0.5,\n  },\n  light: {\n    saturation: 0.7,\n    defaultLightness: 0.6,\n  },\n};\n\n/**\n * Generates a hue with random distribution, stable for a given semver\n * version. Allows passing an `avoidToken` generated by a previous color, to avoid a color similar\n * to it.\n *\n * * Derived from:\n * - http://martin.ankerl.com/2009/12/09/how-to-create-random-colors-programmatically/\n * - https://github.com/devongovett/color-generator\n */\nexport default function generateHue(\n  version: string,\n  avoidToken?: AvoidToken\n): { hue: number; avoidToken: AvoidToken } {\n  const adjacentHueThreshold = 0.4;\n  const allHueThreshold = 0.06;\n\n  const goldenRatio = 0.618033988749895;\n\n  const randomGenerator = randomSeed.create(version);\n  let hue: number;\n  let triesRemaining = 100;\n\n  do {\n    hue = randomGenerator.random();\n    hue += goldenRatio;\n    hue %= 1;\n  } while (\n    avoidToken &&\n    --triesRemaining > 0 &&\n    (hueDifference(hue, avoidToken.adjacentHue) < adjacentHueThreshold ||\n      avoidToken.allHues.find(\n        // eslint-disable-next-line no-loop-func\n        (otherHue) => hueDifference(hue, otherHue) < allHueThreshold\n      ))\n  );\n\n  return {\n    hue: hue * 360,\n    avoidToken: {\n      adjacentHue: hue,\n      allHues: [...(avoidToken?.allHues ?? []), hue],\n    },\n  };\n}\n\nconst colorCache: Partial<\n  Record<\n    number,\n    Array<{\n      variant?: \"light\" | \"dark\";\n      targetLuminance?: \"contrasts-light\" | \"contrasts-dark\";\n      result: string;\n    }>\n  >\n> = {};\n\n/**\n * Calculates a color with the given hue, optionally specified to meet a\n * specific contrast requirement\n */\nexport function colorForHue(\n  hue: number,\n  opts?: {\n    variant?: \"light\" | \"dark\";\n    targetLuminance?: \"contrasts-light\" | \"contrasts-dark\";\n  }\n) {\n  const cacheEntry = colorCache[hue] ?? [];\n  for (const record of cacheEntry) {\n    if (\n      record.targetLuminance === opts?.targetLuminance &&\n      record.variant === opts?.variant\n    ) {\n      return record.result;\n    }\n  }\n\n  const saturation =\n    opts?.variant === \"dark\" ? styles.dark.saturation : styles.light.saturation;\n\n  const defaultLightness =\n    opts?.variant === \"dark\"\n      ? styles.dark.defaultLightness\n      : styles.light.defaultLightness;\n\n  const lightness = adjustLightnessForContrast(\n    defaultLightness,\n    hue,\n    saturation,\n    opts?.targetLuminance\n  );\n\n  const result = `hsl(${hue}, ${saturation * 100}%, ${lightness * 100}%)`;\n  cacheEntry.push({\n    variant: opts?.variant,\n    targetLuminance: opts?.targetLuminance,\n    result,\n  });\n  return result;\n}\n\nfunction hueDifference(hue1: number, hue2: number) {\n  return Math.abs(((hue1 - hue2 + 0.5) % 1.0) - 0.5);\n}\n\nfunction adjustLightnessForContrast(\n  lightness: number,\n  h: number,\n  s: number,\n  contrastingColor?: \"contrasts-light\" | \"contrasts-dark\"\n) {\n  if (contrastingColor === \"contrasts-light\") {\n    while (\n      relativeLuminance(h, s, lightness) > styles.againstLight.maxLuminance\n    ) {\n      lightness -= 0.02;\n    }\n  } else if (contrastingColor === \"contrasts-dark\") {\n    while (\n      relativeLuminance(h, s, lightness) < styles.againstDark.minLuminance\n    ) {\n      lightness += 0.02;\n    }\n  }\n\n  return lightness;\n}\n\n/**\n * Calculate the relative luminance which is how bright the color is from the perspective of\n * a human eye.  Blue is much darker than green for instance so (0, 0, 255) is perceived to be\n * significantly darker than (0, 255, 0).  This is used to calculate contrast ratios between\n * two colors to ensure text is readable.\n */\nexport function relativeLuminance(h: number, s: number, l: number): number {\n  const { r, g, b } = hsl2rgb(h, s, l);\n\n  // Formula defined by: http://www.w3.org/TR/UNDERSTANDING-WCAG20/visual-audio-contrast-contrast.html#contrast-ratiodef\n  // relative luminance: http://www.w3.org/TR/2008/REC-WCAG20-20081211/#relativeluminancedef\n\n  // get the effective radius for each color\n  const r1 = standardToLinear(r / 255);\n  const g1 = standardToLinear(g / 255);\n  const b1 = standardToLinear(b / 255);\n\n  // relative luminance adjusts the R/G/B values by modifiers for their perceived brightness\n  // to produce lightness result for how the eye perceives the color\n  return 0.2126 * r1 + 0.7152 * g1 + 0.0722 * b1;\n}\n\n/**\n * Converts an r, g, or b value in the sRGB color space to the corresponding value in linearRGB\n * This is necessary for relative luminance calculations\n * Formula defined at https://en.wikipedia.org/wiki/SRGB\n *\n * @param c - one of r g or b coming from sRGB\n */\nfunction standardToLinear(c: number): number {\n  return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);\n}\n\nfunction hsl2rgb(\n  h: number,\n  s: number,\n  l: number\n): { r: number; g: number; b: number } {\n  const c: number = (1 - Math.abs(2 * l - 1)) * s;\n  const x: number = c * (1 - Math.abs(((h / 60) % 2) - 1));\n  const m: number = l - c / 2;\n\n  let r1: number = 0;\n  let g1: number = 0;\n  let b1: number = 0;\n\n  // different values of h\n  if (h < 60) {\n    r1 = c;\n    g1 = x;\n    b1 = 0;\n  } else if (h < 120) {\n    r1 = x;\n    g1 = c;\n    b1 = 0;\n  } else if (h < 180) {\n    r1 = 0;\n    g1 = c;\n    b1 = x;\n  } else if (h < 240) {\n    r1 = 0;\n    g1 = x;\n    b1 = c;\n  } else if (h < 300) {\n    r1 = x;\n    g1 = 0;\n    b1 = c;\n  } else {\n    r1 = c;\n    g1 = 0;\n    b1 = x;\n  }\n\n  return {\n    r: Math.round(255 * (r1 + m)),\n    g: Math.round(255 * (g1 + m)),\n    b: Math.round(255 * (b1 + m)),\n  };\n}\n","import { ITheme } from \"@fluentui/react\";\n\nimport type {\n  AreaProps,\n  CartesianGridProps,\n  ResponsiveContainerProps,\n  TooltipProps,\n  XAxisProps,\n  YAxisProps,\n} from \"recharts\";\nimport { Unit } from \"../components/VersionDownloadChart\";\n\ntype AnimationProps =\n  | \"animationDuration\"\n  | \"animationEasing\"\n  | \"isAnimationActive\";\ntype DimensionProps = \"width\" | \"height\";\ntype PaddingProps = \"padding\";\ntype StrokeProps = \"stroke\" | \"strokeDasharray\" | \"strokeOpacity\";\ntype TickProps =\n  | \"tick\"\n  | \"tickCount\"\n  | \"tickLine\"\n  | \"tickSize\"\n  | \"tickMargin\"\n  | \"minTickGap\";\n\nexport type VersionDownloadChartStyle = (opts?: {\n  theme?: ITheme;\n  unit?: Unit;\n}) => {\n  areaChart: {\n    margin?: { top?: number; right?: number; bottom?: number; left?: number };\n  };\n  area: Pick<AreaProps, AnimationProps | DimensionProps>;\n  responsiveContainer: Pick<ResponsiveContainerProps, DimensionProps>;\n  grid: Pick<CartesianGridProps, DimensionProps | StrokeProps>;\n  xAxis: Pick<XAxisProps, DimensionProps | PaddingProps | TickProps>;\n  yAxis: Pick<YAxisProps, DimensionProps | PaddingProps | TickProps>;\n  tooltip: Pick<TooltipProps<string, number>, AnimationProps | \"offset\">;\n};\n\nconst styles: VersionDownloadChartStyle = ({ theme, unit } = {}) => ({\n  areaChart: {\n    margin: { top: 15, right: 32, bottom: 5 },\n  },\n  area: {\n    isAnimationActive: false,\n    stroke: theme?.isInverted\n      ? theme.palette.whiteTranslucent40\n      : theme?.palette.blackTranslucent40,\n  },\n  responsiveContainer: {\n    width: \"100%\",\n    height: 220,\n  },\n  grid: {\n    stroke: theme?.isInverted\n      ? theme.palette.whiteTranslucent40\n      : theme?.palette.blackTranslucent40,\n    strokeDasharray: \"1 1\",\n  },\n  xAxis: {\n    height: 32,\n    tickLine: false,\n    tickMargin: 10,\n    tick: { fill: theme?.semanticColors.bodyText },\n  },\n  yAxis: {\n    width: 80,\n    tickLine: false,\n    tickMargin: 10,\n    tickSize: 0,\n    tickCount: 5,\n    tick: { fill: theme?.semanticColors.bodyText },\n  },\n  tooltip: {\n    animationDuration: 150,\n    animationEasing: \"linear\",\n    offset: 24,\n  },\n});\n\nexport default styles;\n","import styles from \"../styles/VersionTooltip.module.scss\";\nimport { ITheme, Text, ThemeContext, ThemeProvider } from \"@fluentui/react\";\n\nimport { TooltipProps } from \"recharts\";\nimport { Unit } from \"./VersionDownloadChart\";\nimport type { Payload } from \"recharts/types/component/DefaultTooltipContent\";\nimport { colorForHue } from \"../chartColor\";\n\ntype DateTooltipProps = TooltipProps<number, number>;\n\nfunction formatCount(\n  count: number,\n  entry: Payload<number, number>,\n  measurementTransform: Unit | undefined\n): string {\n  const { versionCounts } = entry.payload as {\n    versionCounts: Record<string, number>;\n  };\n\n  const totalCount = Object.values(versionCounts).reduce((a, b) => a + b, 0);\n\n  const pct = ((count as number) / totalCount) * 100;\n\n  if (measurementTransform === \"percentage\") {\n    return `${Math.round(pct * 100) / 100}%`;\n  } else {\n    return `${count.toLocaleString()} (${Math.round(pct)}%)`;\n  }\n}\n\nfunction formatLabel(unixTime: number): string {\n  return new Date(unixTime).toLocaleDateString(\"en-US\", {\n    month: \"short\",\n    day: \"numeric\",\n  });\n}\n\nexport function createTooltipContent(\n  props: VersionProps\n): React.FC<DateTooltipProps> {\n  return (tooltipProps) => (\n    <VersionTooltipContent {...props} {...tooltipProps} />\n  );\n}\n\nexport type VersionProps = {\n  versionHues: Record<string, number>;\n  unit?: Unit;\n  theme?: ITheme;\n};\n\nexport const VersionTooltipContent: React.FC<\n  VersionProps & DateTooltipProps\n> = ({ label, payload, unit, versionHues, theme }) => {\n  const reversedItems = [...(payload ?? [])];\n  reversedItems.reverse();\n\n  return (\n    <ThemeContext.Consumer>\n      {(contextTheme) => {\n        theme = theme ?? contextTheme;\n\n        const versionsList = reversedItems.length > 0 && (\n          <ul className={styles.versionsList}>\n            {reversedItems.map((entry, i) => {\n              const colorChipColor = theme\n                ? colorForHue(\n                    versionHues[entry.name!],\n                    theme.isInverted\n                      ? { variant: \"dark\", targetLuminance: \"contrasts-dark\" }\n                      : { variant: \"light\", targetLuminance: \"contrasts-light\" }\n                  )\n                : entry.color;\n\n              const formattedValue = formatCount(entry.value!, entry, unit);\n\n              return (\n                <li key={i} className={styles.versionsListItem}>\n                  <div\n                    className={styles.versionColorIndicator}\n                    style={{ backgroundColor: colorChipColor }}\n                  />\n                  <Text variant=\"small\" className={styles.versionLabel}>\n                    {entry.name}\n                  </Text>\n                  <Text variant=\"small\" className={styles.versionCount}>\n                    {formattedValue}\n                  </Text>\n                </li>\n              );\n            })}\n          </ul>\n        );\n\n        return (\n          <ThemeProvider\n            theme={theme}\n            className={styles.frame}\n            style={{\n              backgroundColor: (theme ?? contextTheme)?.semanticColors\n                .bodyBackground,\n            }}\n          >\n            <Text className={styles.date} variant=\"medium\">\n              {formatLabel(label!)}\n            </Text>\n            {versionsList}\n          </ThemeProvider>\n        );\n      }}\n    </ThemeContext.Consumer>\n  );\n};\n","import React, { useState } from \"react\";\n\nimport generateHue, { AvoidToken, colorForHue } from \"../chartColor\";\nimport styleProps from \"../styles/VersionDownloadChart.styles\";\nimport { createTooltipContent } from \"./VersionTooltip\";\n\nimport {\n  AreaChart,\n  Area,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  Legend,\n} from \"recharts\";\nimport type { HistoryPointCollection, HistoryPoint } from \"../HistoryReader\";\nimport { ITheme } from \"@fluentui/react\";\n\nimport { createPortal } from \"react-dom\";\nimport { createLegendContent } from \"./VersionLegend\";\n\nexport type Unit = \"totalDownloads\" | \"percentage\";\n\nexport type VersionLabeler = (version: string) => string;\n\nexport type VersionDownloadChartProps = {\n  /**\n   * Points to render\n   */\n  history: HistoryPointCollection;\n\n  /**\n   * Maximum duration the graph will show, in days\n   */\n  maxDaysShown?: number;\n\n  /**\n   * Maximum total ticks to show for dates/times\n   */\n  maxTicks?: number;\n\n  /**\n   * Maximum separate versions show, attempting to show most popular versions.\n   */\n  maxVersionsShown?: number;\n\n  /**\n   * Whether to show the legend (defaults to true)\n   */\n  showLegend?: boolean;\n\n  /**\n   * Whether to show the tooltip (defaults to true)\n   */\n  showTooltip?: boolean;\n\n  /**\n   * The unit to show in the Y axis\n   */\n  unit?: Unit;\n\n  /**\n   * Allows relabeling versions\n   */\n  versionLabeler?: VersionLabeler;\n\n  /**\n   * Theme, used to ensure we have enough contrast.\n   */\n  theme?: ITheme;\n\n  /**\n   * Override the default provided theme for the tooltip\n   */\n  tooltipTheme?: ITheme;\n};\n\nconst VersionDownloadChart: React.FC<VersionDownloadChartProps> = ({\n  history,\n  maxDaysShown,\n  maxVersionsShown,\n  maxTicks,\n  showLegend,\n  showTooltip,\n  unit,\n  versionLabeler,\n  theme,\n  tooltipTheme,\n}) => {\n  const styles = styleProps({ theme, unit });\n\n  const [legendElement, setLegendElement] = useState<HTMLDivElement>();\n\n  const filteredHistory = React.useMemo(\n    () => filterTopN(history, maxVersionsShown ?? 5, maxDaysShown ?? 30),\n    [history, maxDaysShown, maxVersionsShown]\n  );\n\n  const dateTicks = React.useMemo(\n    () =>\n      calculateDateTicks(\n        filteredHistory.points.map((p) => p.date),\n        maxTicks ?? 6\n      ),\n    [filteredHistory.points, maxTicks]\n  );\n\n  const versionHues = React.useMemo(() => {\n    const hues: Record<string, number> = {};\n    let lastAvoidToken: AvoidToken | undefined;\n\n    filteredHistory.versions.forEach((v) => {\n      const { hue, avoidToken } = generateHue(v, lastAvoidToken);\n      lastAvoidToken = avoidToken;\n      hues[versionLabeler ? versionLabeler(v) : v] = hue;\n    });\n\n    return hues;\n  }, [filteredHistory.versions, versionLabeler]);\n\n  const chartAreas = React.useMemo(\n    () =>\n      filteredHistory.versions\n        .map((v) => {\n          const name = versionLabeler ? versionLabeler(v) : v;\n          const hue = versionHues[name];\n          const colorVariant = theme?.isInverted ? \"dark\" : \"light\";\n          const fill = colorForHue(hue, {\n            variant: colorVariant,\n            targetLuminance: theme?.isInverted\n              ? \"contrasts-light\"\n              : \"contrasts-dark\",\n          });\n          return { name, hue, fill, dataKey: v };\n        })\n        .reverse(),\n    [filteredHistory.versions, theme?.isInverted, versionHues, versionLabeler]\n  );\n\n  if (filteredHistory.points.length === 0) {\n    return null;\n  }\n\n  const VersionLegend = React.memo(createLegendContent({ versionHues }));\n\n  return (\n    <div>\n      <ResponsiveContainer {...styles.responsiveContainer}>\n        <AreaChart\n          {...styles.areaChart}\n          data={filteredHistory.points}\n          reverseStackOrder\n          stackOffset={unit === \"percentage\" ? \"expand\" : \"none\"}\n        >\n          <XAxis\n            {...styles.xAxis}\n            dataKey=\"date\"\n            type=\"number\"\n            scale=\"time\"\n            domain={[\"dataMin\", \"dataMax\"]}\n            tickFormatter={(unixTime) =>\n              new Date(unixTime).toLocaleDateString(\"en-US\", {\n                month: \"short\",\n                day: \"numeric\",\n              })\n            }\n            interval={0}\n            ticks={dateTicks}\n          />\n          <YAxis\n            {...styles.yAxis}\n            type=\"number\"\n            {...(unit === \"percentage\"\n              ? {\n                  domain: [0, 1],\n                  tickFormatter: (count) => `${Math.round(count * 100)}%`,\n                }\n              : {\n                  domain: [\"auto\", \"auto\"],\n                  tickFormatter: (count) => count.toLocaleString(),\n                })}\n          />\n\n          {showTooltip !== false && (\n            <Tooltip\n              {...styles.tooltip}\n              content={createTooltipContent({\n                versionHues,\n                unit,\n                theme: tooltipTheme,\n              })}\n            />\n          )}\n          {showLegend !== false && legendElement && (\n            <Legend\n              height={0}\n              content={({ payload }) =>\n                createPortal(\n                  payload && <VersionLegend payload={payload} />,\n                  legendElement\n                )\n              }\n            />\n          )}\n\n          {chartAreas.map(({ name, fill, dataKey }) => (\n            <Area\n              {...styles.area}\n              name={name}\n              key={name}\n              dataKey={(datapoint) => datapoint.versionCounts[dataKey]}\n              stackId=\"1\"\n              fill={fill}\n              fillOpacity={1}\n            />\n          ))}\n\n          <CartesianGrid {...styles.grid} />\n        </AreaChart>\n      </ResponsiveContainer>\n      <div ref={(el) => setLegendElement(el ?? undefined)} />\n    </div>\n  );\n};\n\nfunction calculateDateTicks(dates: number[], maxTicks: number): number[] {\n  if (maxTicks === 0) {\n    return [];\n  }\n\n  const first = dates[0];\n  const last = dates[dates.length - 1];\n\n  if (maxTicks === 1) {\n    return [first];\n  }\n\n  if (maxTicks === 2) {\n    return [first, last];\n  }\n\n  const dataDuration = last - first;\n  const dayDuration = 24 * 60 * 60 * 1000;\n  const weekDuration = 7 * dayDuration;\n\n  const maxInteriorTicks = maxTicks - 1;\n  let tickInterval = weekDuration;\n  while (Math.floor(dataDuration / tickInterval) > maxInteriorTicks) {\n    tickInterval *= 2;\n  }\n\n  const ticks = new Set([first]);\n  let nextTick = fromDayStart(first, tickInterval);\n\n  for (const date of dates) {\n    if (date >= nextTick) {\n      ticks.add(date);\n      nextTick = fromDayStart(date, tickInterval);\n    }\n  }\n\n  return [...ticks];\n}\n\nfunction fromDayStart(date: number, duration: number): number {\n  const dayStart = new Date(date);\n  dayStart.setHours(0, 0, 0, 0);\n\n  return dayStart.getTime() + duration;\n}\n\nfunction filterTopN(\n  history: HistoryPointCollection,\n  n: number,\n  windowInDays: number\n): HistoryPointCollection {\n  if (history.points.length === 0) {\n    return history;\n  }\n\n  const latestDate = history.points[history.points.length - 1].date;\n  const latestDay = new Date(latestDate).setHours(0, 0, 0, 0);\n\n  const earliestAllowableDate = latestDay - windowInDays * 24 * 60 * 60 * 1000;\n  const versionsInWindow: { [version: string]: number | undefined } = {};\n\n  for (const point of history.points) {\n    if (point.date >= earliestAllowableDate) {\n      for (const [version, count] of Object.entries(point.versionCounts)) {\n        const existingCount = versionsInWindow[version] ?? 0;\n        versionsInWindow[version] = existingCount + count!;\n      }\n    }\n  }\n\n  const topVersions = new Set(\n    Object.entries(versionsInWindow)\n      .sort((a, b) => a[1]! - b[1]!)\n      .slice(-n)\n      .map(([version, _count]) => version)\n  );\n\n  const filteredPoints: HistoryPoint[] = [];\n\n  for (const point of history.points) {\n    if (point.date >= earliestAllowableDate) {\n      const topVersionsOnDate = Object.keys(point.versionCounts).filter((v) =>\n        topVersions.has(v)\n      );\n\n      if (topVersionsOnDate.length > 0) {\n        const filteredPoint: HistoryPoint = {\n          date: point.date,\n          versionCounts: {},\n        };\n\n        for (const topVersion of topVersionsOnDate) {\n          filteredPoint.versionCounts[topVersion] =\n            point.versionCounts[topVersion];\n        }\n\n        filteredPoints.push(filteredPoint);\n      }\n    }\n  }\n\n  return {\n    versions: history.versions.filter((v) => topVersions.has(v)),\n    points: filteredPoints,\n  };\n}\n\nexport default VersionDownloadChart;\n","import type { Payload } from \"recharts/types/component/DefaultLegendContent\";\nimport styles from \"../styles/VersionLegend.module.scss\";\n\nimport { Text, ThemeContext } from \"@fluentui/react\";\nimport { colorForHue } from \"../chartColor\";\n\ntype CreateOptions = {\n  versionHues: Record<string, number>;\n};\n\nexport function createLegendContent(\n  opts: CreateOptions\n): React.FC<{ payload: Payload[] }> {\n  return ({ payload }) => {\n    return (\n      <ThemeContext.Consumer>\n        {(theme) => (\n          <div className={styles.versionsListContainer}>\n            <ul className={styles.versionsList}>\n              {payload.map((entry) => {\n                const colorChipColor = theme\n                  ? colorForHue(\n                      opts.versionHues[entry.value!],\n                      theme.isInverted\n                        ? { variant: \"dark\", targetLuminance: \"contrasts-dark\" }\n                        : {\n                            variant: \"light\",\n                            targetLuminance: \"contrasts-light\",\n                          }\n                    )\n                  : entry.color!;\n\n                return (\n                  <li key={entry.value} className={styles.versionsListItem}>\n                    <div\n                      className={styles.versionColorIndicator}\n                      style={{ backgroundColor: colorChipColor }}\n                    />\n                    <Text variant=\"small\" className={styles.versionLabel}>\n                      {entry.value}\n                    </Text>\n                  </li>\n                );\n              })}\n            </ul>\n          </div>\n        )}\n      </ThemeContext.Consumer>\n    );\n  };\n}\n"],"sourceRoot":""}